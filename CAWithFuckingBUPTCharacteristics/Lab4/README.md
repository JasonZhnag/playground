# Lab 4

（1） 自行编写一个实现冒泡排序的汇编程序，该程序要求可以实现对一维整数数组
进行冒泡排序。

冒泡排序算法的运作如下：

①比较相邻的元素。如果第一个比第二个大，就交换他们两个。

②对每一对相邻元素作同样的工作，从开始第一对到结尾的最后一对。在这一点，
最后的元素应该会是最大的数。

③针对所有的元素重复以上的步骤，除了最后一个。

④持续每次对越来越少的元素重复上面的步骤，直到没有任何一对数字需要比较。

```
.text
main:
ADDIU  $r4,$r0,a
ADDIU  $r5,$r0,n
LW     $r5, 0($r5)
BGEZAL  $r0, bubble
NOP 
TEQ $r0,$r0

bubble:
ADDIU  $r7, $r5, -1
BLEZ   $r7, exit
SLL    $r5, $r5, 2
ADDIU  $r8, $r4, 4
ADDU   $r6, $r4, $r5
loop:
ADDIU  $r2, $r8, 0
run:
LW     $r3, -4($r2)
LW     $r4, 0($r2)
SLT    $r5, $r4, $r3
BEQ    $r5, $r0, end
swap:
SW     $r4, -4($r2)
SW     $r3, 0($r2)
end:
ADDIU  $r2, $r2, 4
BNE    $r6, $r2, run

ADDIU  $r7, $r7, -1
ADDIU  $r6, $r6, -4
BNE    $r7, $r0, loop

exit:
JR     $r31

.data
a: 
.word 11,10,9,8,7,6,5,4,3,2,1
n:
.word 11
```

要求数组长度不得小于 10

（2）启动 MIPSsim。

（3）载入自己编写的程序，观察流水线输出结果。

```
  汇总：
    执行周期总数：981
    ID段执行了492条指令

  硬件配置：
    内存容量：4096 B
    加法器个数：1		执行时间（周期数）：6
    乘法器个数：1		执行时间（周期数）7		
    除法器个数：1		执行时间（周期数）10		
    定向机制：不采用

  停顿（周期数）：
    RAW停顿：365		占周期总数的百分比：37.20693%
    其中：
      load停顿：110		占所有RAW停顿的百分比：30.13699%
      浮点停顿：0		占所有RAW停顿的百分比：0%
    WAW停顿：0		占周期总数的百分比：0%
    结构停顿：0		占周期总数的百分比：0%
    控制停顿：123		占周期总数的百分比：12.53823%
    自陷停顿：0		占周期总数的百分比：0%
    停顿周期总数：488	占周期总数的百分比：49.74516%

  分支指令：
    指令条数：122		占指令总数的百分比：24.79675%
    其中：
      分支成功：56		占分支指令数的百分比：45.90164%
      分支失败：67		占分支指令数的百分比：54.91803%

  load/store指令：
    指令条数：221		占指令总数的百分比：44.9187%
    其中：
      load：111		占load/store指令数的百分比：50.22625%
      store：110		占load/store指令数的百分比：49.77375%

  浮点指令：
    指令条数：0		占指令总数的百分比：0%
    其中：
      加法：0		占浮点指令数的百分比：0%
      乘法：0		占浮点指令数的百分比：0%
      除法：0		占浮点指令数的百分比：0%

  自陷指令：
    指令条数：1		占指令总数的百分比：0.203252%
```

（4）使用定向功能再次执行代码，与刚才执行结果进行比较，观察执行效率的不同。

```
  汇总：
    执行周期总数：782
    ID段执行了492条指令

  硬件配置：
    内存容量：4096 B
    加法器个数：1		执行时间（周期数）：6
    乘法器个数：1		执行时间（周期数）7		
    除法器个数：1		执行时间（周期数）10		
    定向机制：采用

  停顿（周期数）：
    RAW停顿：166		占周期总数的百分比：21.22762%
    其中：
      load停顿：55		占所有RAW停顿的百分比：33.13253%
      浮点停顿：0		占所有RAW停顿的百分比：0%
    WAW停顿：0		占周期总数的百分比：0%
    结构停顿：0		占周期总数的百分比：0%
    控制停顿：123		占周期总数的百分比：15.7289%
    自陷停顿：0		占周期总数的百分比：0%
    停顿周期总数：289	占周期总数的百分比：36.95652%

  分支指令：
    指令条数：122		占指令总数的百分比：24.79675%
    其中：
      分支成功：56		占分支指令数的百分比：45.90164%
      分支失败：67		占分支指令数的百分比：54.91803%

  load/store指令：
    指令条数：221		占指令总数的百分比：44.9187%
    其中：
      load：111		占load/store指令数的百分比：50.22625%
      store：110		占load/store指令数的百分比：49.77375%

  浮点指令：
    指令条数：0		占指令总数的百分比：0%
    其中：
      加法：0		占浮点指令数的百分比：0%
      乘法：0		占浮点指令数的百分比：0%
      除法：0		占浮点指令数的百分比：0%

  自陷指令：
    指令条数：1		占指令总数的百分比：0.203252%
```

（5）采用静态调度方法重排指令序列，减少相关，优化程序

> 几乎已经是最优 无法继续优化

（6）对优化后的程序使用定向功能执行，与刚才执行结果进行比较，观察执行效率的
不同。

> 无